#scale_y_continuous(breaks = seq(0,1,0.25),limits=c(0,1), expand = c(0.02, 0)) +
scale_x_discrete(labels=c("A10" = "M.8780",
"A20" = "M.5246",
"A25" = "M.408",
"A27" = "M.3787",
"A31" = "M.4080",
"A44" = "M.7487",
"A46" = "M.284",
"A5" =  "M.192",
"A55" = "M.25"))
if (!file.exists("similarity.csv")){
sim_samples <- paste(historical$sample[which(historical$sample!="A66")],"_", sep="") # SimilarityPair can only be calculated for assemblages with more than ONE species
sim_holo <- data.frame()
sim_lgm <- data.frame()
sim_null <- data.frame()
for (i in sim_samples){ # i = sim_samples[1]
sim_holo_data <- historical_holocene[,grep(names(historical_holocene), pattern = i)]
sim_holo_i <- SimilarityPair(as.matrix(sim_holo_data), datatype = c("abundance"), nboot = 100)
sim_holo <- rbind(sim_holo,
cbind(rbind(c02 = sim_holo_i$estimated_richness[1,],
c12 = sim_holo_i$estimated_relative[1,],
c22 = sim_holo_i$estimated_relative[2,],
chao_jaccard  = sim_holo_i$estimated_relative[4,],
chao_sorensen = sim_holo_i$estimated_relative[5,]),
sample = rep(i, 5)))
sim_lgm_data <- historical_lgm[,grep(names(historical_lgm), pattern = i)]
sim_lgm_i <- SimilarityPair(as.matrix(sim_lgm_data), datatype = c("abundance"), nboot = 100)
sim_lgm <- rbind(sim_lgm,
cbind(rbind(c02 = sim_lgm_i$estimated_richness[1,],
c12 = sim_lgm_i$estimated_relative[1,],
c22 = sim_lgm_i$estimated_relative[2,],
chao_jaccard  = sim_lgm_i$estimated_relative[4,],
chao_sorensen = sim_lgm_i$estimated_relative[5,]),
sample = rep(i, 5)))
sim_null_data <- holocene_lgm[,grep(names(holocene_lgm), pattern = i)]
sim_null_i <- SimilarityPair(as.matrix(sim_null_data), datatype = c("abundance"), nboot = 100)
sim_null <- rbind(sim_null,
cbind(rbind(c02 = sim_null_i$estimated_richness[1,],
c12 = sim_null_i$estimated_relative[1,],
c22 = sim_null_i$estimated_relative[2,],
chao_jaccard  = sim_null_i$estimated_relative[4,],
chao_sorensen = sim_null_i$estimated_relative[5,]),
sample = rep(i, 5)))
rm(sim_holo_data)
rm(sim_holo_i)
rm(sim_lgm_data)
rm(sim_lgm_i)
rm(sim_null_data)
rm(sim_null_i)
}
sim_holo[,c(1:4)] <- sapply(sim_holo[,c(1:4)], function(x) as.numeric(as.character(x)))
sim_lgm[,c(1:4)]  <- sapply(sim_lgm[,c(1:4)], function(x) as.numeric(as.character(x)))
sim_null[,c(1:4)] <- sapply(sim_null[,c(1:4)], function(x) as.numeric(as.character(x)))
sim_holo$comparison <- "Historical and Holocene"
sim_lgm$comparison  <- "Historical and LGM"
sim_null$comparison <- "LGM and Holocene"
similarity <- rbind(sim_holo,sim_lgm,sim_null)
similarity$sample <- as.factor(sub("_", "", similarity$sample))
similarity$comparison <- as.factor(similarity$comparison)
similarity$index <- row.names(similarity)
similarity <- merge(similarity,historical[,c("sample", "Lat", "Long")])
names(similarity) <- c("sample","Estimate", "se", "lci", "uci", "comparison", "index", "lat", "long")
write.csv(similarity, "similarity.csv", row.names = FALSE)
}else{
similarity <- read.csv("similarity.csv", header = TRUE)
}
sim_data2 <- similarity[grep("c22", similarity$index),] # Morisita-Horn index (relative abundance, rare)
sim_data2$comparison <- sub(pattern = "vs.", replacement = "and", x=sim_data2$comparison)
ggplot(sim_data2, aes(x=sample, y=Estimate, shape=comparison, colour=comparison)) +
geom_errorbar(position=position_dodge(width=0.5), aes(ymin=lci, ymax=uci), width=.2) +
geom_point(position=position_dodge(width=0.5), size=4.5)  + ylim(0,1) +
labs(y = "Compositional similarity", x = "Historical samples (by absolute latitude)") +
theme_bw() +
theme(plot.margin = margin(20, 5.5, 20, 5.5, "pt"),
axis.text=element_text(size=18, colour = "black"),
axis.title=element_text(size=20, colour = "black"),
legend.text = element_text(size=18, colour = "black"),
legend.title = element_blank(),
legend.position = c(0.17, 0.12),
legend.background = element_rect(linetype="solid", size = 0.4, colour ="black")) +
scale_color_manual(values=c("#a6611a", "#018571","#999999")) +
scale_shape_manual(values=c(17, 15, 19)) +
#scale_y_continuous(breaks = seq(0,1,0.25),limits=c(0,1), expand = c(0.02, 0)) +
scale_x_discrete(labels=c("A10" = "M.8780",
"A20" = "M.5246",
"A25" = "M.408",
"A27" = "M.3787",
"A31" = "M.4080",
"A44" = "M.7487",
"A46" = "M.284",
"A5" =  "M.192",
"A55" = "M.25"))
morisita_horn <- ggplot(sim_data2, aes(x=sample, y=Estimate, shape=comparison, colour=comparison)) +
geom_errorbar(position=position_dodge(width=0.5), aes(ymin=lci, ymax=uci), width=.2) +
geom_point(position=position_dodge(width=0.5), size=4.5)  + ylim(0,1) +
labs(y = "Compositional similarity", x = "Historical samples (by absolute latitude)") +
theme_bw() +
theme(plot.margin = margin(20, 5.5, 20, 5.5, "pt"),
axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=20, colour = "black"),
legend.text = element_text(size=18, colour = "black"),
legend.title = element_blank(),
legend.position = c(0.17, 0.12),
legend.background = element_rect(linetype="solid", size = 0.4, colour ="black")) +
scale_color_manual(values=c("#a6611a", "#018571","#999999")) +
scale_shape_manual(values=c(17, 15, 19)) +
#scale_y_continuous(breaks = seq(0,1,0.25),limits=c(0,1), expand = c(0.02, 0)) +
scale_x_discrete(labels=c("A10" = "M.8780",
"A20" = "M.5246",
"A25" = "M.408",
"A27" = "M.3787",
"A31" = "M.4080",
"A44" = "M.7487",
"A46" = "M.284",
"A5" =  "M.192",
"A55" = "M.25"))
png(file = "fig_morisita-horn.png", width = 11.5, height = 7, units = "in", res = 300)
print(morisita_horn)
dev.off()
# Morista-Horn
sim_data2$comparison <- sub(pattern = "vs.", replacement = "and", x=sim_data2$comparison)
morisita_horn <- ggplot(sim_data2, aes(x=sample, y=Estimate, shape=comparison, colour=comparison)) +
geom_errorbar(position=position_dodge(width=0.5), aes(ymin=lci, ymax=uci), width=.2) +
geom_point(position=position_dodge(width=0.5), size=4.5)  + ylim(0,1) +
labs(y = "Compositional similarity", x = "Historical samples (by absolute latitude)") +
theme_bw() +
theme(plot.margin = margin(20, 5.5, 20, 5.5, "pt"),
axis.text=element_text(size=16, colour = "black"),
axis.title=element_text(size=20, colour = "black"),
legend.text = element_text(size=18, colour = "black"),
legend.title = element_blank(),
legend.position = c(0.17, 0.12),
legend.background = element_rect(linetype="solid", size = 0.4, colour ="black")) +
scale_color_manual(values=c("#a6611a", "#018571","#999999")) +
scale_shape_manual(values=c(17, 15, 19)) +
#scale_y_continuous(breaks = seq(0,1,0.25),limits=c(0,1), expand = c(0.02, 0)) +
scale_x_discrete(labels=c("A10" = "M.8780",
"A20" = "M.5246",
"A25" = "M.408",
"A27" = "M.3787",
"A31" = "M.4080",
"A44" = "M.7487",
"A46" = "M.284",
"A5" =  "M.192",
"A55" = "M.25"))
png(file = "fig_morisita-horn.png", width = 11.5, height = 7, units = "in", res = 300)
print(morisita_horn)
dev.off()
# Morista-Horn
sim_data2$comparison <- sub(pattern = "vs.", replacement = "and", x=sim_data2$comparison)
morisita_horn <- ggplot(sim_data2, aes(x=sample, y=Estimate, shape=comparison, colour=comparison)) +
geom_errorbar(position=position_dodge(width=0.5), aes(ymin=lci, ymax=uci), width=.2) +
geom_point(position=position_dodge(width=0.5), size=4.5)  + ylim(0,1) +
labs(y = "Compositional similarity", x = "Historical samples") +
theme_bw() +
theme(plot.margin = margin(20, 5.5, 20, 5.5, "pt"),
axis.text=element_text(size=16, colour = "black"),
axis.title=element_text(size=20, colour = "black"),
legend.text = element_text(size=18, colour = "black"),
legend.title = element_blank(),
legend.position = c(0.17, 0.12),
legend.background = element_rect(linetype="solid", size = 0.4, colour ="black")) +
scale_color_manual(values=c("#a6611a", "#018571","#999999")) +
scale_shape_manual(values=c(17, 15, 19)) +
#scale_y_continuous(breaks = seq(0,1,0.25),limits=c(0,1), expand = c(0.02, 0)) +
scale_x_discrete(labels=c("A10" = "M.8780",
"A20" = "M.5246",
"A25" = "M.408",
"A27" = "M.3787",
"A31" = "M.4080",
"A44" = "M.7487",
"A46" = "M.284",
"A5" =  "M.192",
"A55" = "M.25"))
png(file = "fig_morisita-horn.png", width = 11.5, height = 7, units = "in", res = 300)
print(morisita_horn)
dev.off()
### Data
# Finding ForCenS neigbours of LGM
if (!file.exists("LGM_ForCenS_neighbours.csv")){
forcens_lgm <- data.frame()
for(j in 1:nrow(lgm_full)){
point <- as.numeric(lgm_full[j,c("Long","Lat")])
forcens_neighb <- find_neighbours(point, findin = holocene_full[,c("Longitude","Latitude")], distance = 0)
forcens_lgm <- rbind(forcens_lgm, cbind(lgm_row = j, lgm_long = point[1], lgm_lat = point[2],
forcens_neighb, holocene_full[forcens_neighb$row_findin,]))
}
write.csv(forcens_lgm, "LGM_ForCenS_neighbours.csv", row.names = F)
}else{
forcens_lgm <- read.csv("LGM_ForCenS_neighbours.csv", header = TRUE)
}
dim(forcens_lgm)
dim(unique(forcens_lgm[,c("lgm_lat", "lgm_long", "distance")]))
unique_lgm <- unique(forcens_lgm[,c("lgm_lat", "lgm_long", "distance")])
median(unique_lgm$distance/1000) # km
### Preparing data
# Creating species datasets by calculating relative abundance
holocene_species <- (forcens_lgm[27:65]/rowSums(forcens_lgm[27:65], na.rm = T))*100
lgm_species <- (lgm_full[,c(17:52,56:58)]/rowSums(lgm_full[,c(17:52,56:58)], na.rm = T))*100
# data.frame(forcens = sort(names(forcens_lgm)[27:65]), lgm = sort(names(lgm_full)[c(17:52,56:58)]))
# Removing unidentified
holocene_species <- holocene_species[,-which(colnames(holocene_species)=="unidentified")]
lgm_species <- lgm_species[,-which(colnames(lgm_species)=="unidentified")]
# Checking if species of both datasets match
data.frame(sort(names(holocene_species)), sort(names(lgm_species)))
# Checking if holocene rows are still in the same order, after all the species corrections
# WHY? To create a 'sample' index/number for each row which will be simply the row number
# ...and why? To be able to later merge metadata (lat, long)
all(row.names(holocene_species) == row.names(forcens_lgm))
all(row.names(lgm_species) == row.names(lgm_full))
# Creating "sample" number (row number) to merge datasets
holocene_species$sample <- paste(1:nrow(holocene_species),"_holocene", sep="")
lgm_species$sample <- paste(1:nrow(lgm_species),"_lgm", sep="")
# Spade R data: species (in rows) by community (in columns) matrix
forcens_lgm <- rbind(holocene_species,lgm_species)
forcens_lgm <- melt(forcens_lgm, id = "sample")
forcens_lgm <- cast(forcens_lgm, variable~sample)
row.names(forcens_lgm) <- forcens_lgm$variable
forcens_lgm <- forcens_lgm[,-which(names(forcens_lgm)=="variable")]
forcens_lgm[1:10,1:10]
lgm_forcens_sim <- read.csv("LGM_ForCenS_c22.csv", header = TRUE)
names(lgm_forcens_sim)
dim(unique(lgm_forcens_sim[,c("Lat", "Long")]))
lgm_forcens_sim_mean <- aggregate(c22~Lat+Long, data=lgm_forcens_sim, FUN=function(x) mean=mean(x))
write.csv(lgm_forcens_sim_mean, "LGM_ForCenS_c22_mean.csv", row.names = FALSE)
# Mean similarity for each lat long grid square - NOT USED
lgm_forcens_sim <- function_name_grid(data = lgm_forcens_sim)
sim_grid_mean <- data.frame(do.call("rbind", by(lgm_forcens_sim[,c("c22","Lat","Long")], lgm_forcens_sim$grid_name, function(x) colMeans(x, na.rm = T))))
sim_grid_mean <- as.data.frame(cbind(sim_grid_mean, grid_name = row.names(sim_grid_mean)))
names(sim_grid_mean)
### Merging historical and LGM ForCenS data for plot
gradient <- c('#bd0026','#f03b20','#fd8d3c','#2b8cbe', 'black')
# Each 0.25
lgm_forcens_sim_mean$similarity <- NA
lgm_forcens_sim_mean[which(lgm_forcens_sim_mean$c22> 0.75),"similarity"] <- as.character("0.75 - 1.0")
lgm_forcens_sim_mean[which(lgm_forcens_sim_mean$c22<=0.75 & lgm_forcens_sim_mean$c22>0.5),"similarity"] <- as.character("0.5 - 0.75")
lgm_forcens_sim_mean[which(lgm_forcens_sim_mean$c22<=0.5 & lgm_forcens_sim_mean$c22>0.25),"similarity"] <- as.character("0.25 - 0.5")
lgm_forcens_sim_mean[which(lgm_forcens_sim_mean$c22< 0.25),"similarity"] <- as.character("0.0 - 0.25")
lgm_forcens_sim_mean$similarity <- as.factor(lgm_forcens_sim_mean$similarity)
lgm_forcens_sim_mean <- lgm_forcens_sim_mean[order(lgm_forcens_sim_mean$similarity, decreasing = T),]
map_data <-  lgm_forcens_sim_mean
historical$c22 <- NA
historical$similarity <- "H"
historical$point <- "Historical"
map_data$point <- "LGM"
map_data$sample <- row.names(map_data)
map_data$similarity <- as.character(map_data$similarity)
map_data <- rbind(map_data, historical[,c("sample", "c22","Lat","Long", "similarity", "point")])
map_data$point <- as.factor(map_data$point)
map_data$similarity <- as.factor(map_data$similarity)
str(map_data)
### Plotting map of geographical similarity
world <- map_data("world")
mapplot <- ggplot(world, mapping = aes(x = long, y = lat, group = group)) +
geom_polygon(fill = "grey60", colour = "grey60") +
theme_bw() + coord_fixed(1.3) +
theme(axis.text=element_text(size=16, colour = "grey60"),
axis.title=element_blank(),
axis.ticks = element_blank(),
plot.margin = margin(5.5, 5.5, 5.5, 5.5, "pt")) + # unit with the sizes of the top, right, bottom, and left margins)
scale_x_continuous(breaks = seq(-180, +180, 40), position = "bottom", limits=c(-180, 180), expand = c(0.02, 0.02),
labels=c(expression("180"*degree*W),
expression("140"*degree*W),
expression("100"*degree*W),
expression("60"*degree*W),
expression("20"*degree*W),
expression("20"*degree*E),
expression("60"*degree*E),
expression("100"*degree*E),
expression("140"*degree*E),
expression("180"*degree*E))
) +
scale_y_continuous(breaks = seq(-80,80,20),limits=c(-90,90), expand = c(0, 0),
labels=c(expression("80"*degree*S),
expression("60"*degree*S),
expression("40"*degree*S),
expression("20"*degree*S),
expression("0"*degree),
expression("20"*degree*N),
expression("40"*degree*N),
expression("60"*degree*N),
expression("80"*degree*N))
)
mappoints_all <- mapplot + geom_point(data = map_data,
aes(x = Long, y = Lat, group = sample, fill = similarity, shape = point),
color = "black", size = 4, stroke = 0.2) +
scale_fill_manual(values = gradient, name = "Compositional similarity (LGM and Holocene)",
breaks = c("0.0 - 0.25","0.25 - 0.5","0.5 - 0.75","0.75 - 1.0")) +
scale_shape_manual(values=c(24, 21), name = "Dataset") +
theme(legend.text=element_text(size=17),
legend.direction = "horizontal",
#legend.position = c(0.275, 0.078),
legend.position = c(0.5, 0.07),
legend.box = "horizontal",
legend.title = element_text(size=18),
legend.background = element_rect(linetype="solid", size = 0.4, colour ="black")) +
guides(fill = guide_legend(override.aes=list(shape=21),nrow = 1, title.position = "top", order = 2),
shape = guide_legend(override.aes = list(fill = "black"),nrow = 1, title.position = "top", order = 1))
# saving map
png(file = "map_lgm_similarity_mean.png", width = 11.5, height = 7, units = "in", res = 300)
print(mappoints_all)
dev.off()
# Final Figure 1
png(file = "figure_1.png", width=11.5, height=15, units = "in", res = 300)
print(ggarrange(morisita_horn, mappoints_all, ncol = 1, nrow = 2, align="v"))
dev.off()
lgm
lgm[,c("Core", "sed_rate_cmky")]
lgm[,c("Core", "sed_rate_cmky", "distance")]
mean(lgm[,"sed_rate_cmky"], na.rm = T)
sed_rate_lgm
dim9sed_rate_lgm
dim(sed_rate_lgm)
median(sed_rate_lgm$sed_rate_cmky)
mean(sed_rate_lgm$sed_rate_cmky)
lgm_forcens_sim_mean$similarity
lgm_forcens_sim_mean
names(lgm_full)
?merge
names(lgm_forcens_sim_mean)
sim_sed <- merge(lgm_forcens_sim_mean,lgm_full[,c("Lat", "Long","Core","Water.depth..m.", "Ocean", "sed_rate_cmky")])
dim(lgm_forcens_sim_mean)
dim(sim_sed)
head(sim_sed)
sim_sed <- merge(lgm_forcens_sim_mean,
lgm_full[,c("Lat", "Long","Core","Water.depth..m.", "Ocean", "sed_rate_cmky")],
all=F)
dim(sim_sed)
sim_sed <- merge(lgm_forcens_sim_mean,
lgm_full[,c("Lat", "Long","Core","Water.depth..m.", "Ocean", "sed_rate_cmky")],
all.x=F)
dim(sim_sed)
sim_sed <- merge(lgm_forcens_sim_mean,
lgm_full[,c("Lat", "Long","Core","Water.depth..m.", "Ocean", "sed_rate_cmky")],
all.y=F)
dim(sim_sed)
dim(lgm_forcens_sim_mean)
plot(sim_sed$c22~sim_sed$sed_rate_cmky)
names(sim_sed)
sim_sed <- unique(sim_sed[,c("c22","Lat", "Long","Core","Water.depth..m.", "Ocean", "sed_rate_cmky")])
dim(sim_sed)
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22, colour=Water.depth..m.)) +
geom_point(size=2) +
labs(y = "Compositional similarity between LGM and Holocene", x = "Sedimentation rate (cm/ky)") +
theme_bw()
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22, colour=Water.depth..m.)) +
geom_point(size=2) + xlim(0,20)
labs(y = "Compositional similarity between LGM and Holocene", x = "Sedimentation rate (cm/ky)") +
theme_bw()
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22, colour=Water.depth..m.)) +
geom_point(size=2) + xlim(0,20) +
labs(y = "Compositional similarity between LGM and Holocene", x = "Sedimentation rate (cm/ky)") +
theme_bw()
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22, colour=Ocean)) +
geom_point(size=2) + xlim(0,20) +
labs(y = "Compositional similarity between LGM and Holocene", x = "Sedimentation rate (cm/ky)") +
theme_bw()
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22, colour=Ocean)) +
geom_point(size=2) + xlim(0,20) +
labs(y = "Compositional similarity between LGM and Holocene", x = "Sedimentation rate (cm/ky)") +
theme_bw()
sim_sed$Ocean
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2) + xlim(0,20) +
labs(y = "Compositional similarity between LGM and Holocene", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=16, colour = "black"),
axis.title=element_text(size=20, colour = "black"))
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21) + xlim(0,20) +
labs(y = "Compositional similarity (LGM & Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=16, colour = "black"),
axis.title=element_text(size=20, colour = "black"))
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.5)) + xlim(0,20) +
labs(y = "Compositional similarity (LGM & Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=16, colour = "black"),
axis.title=element_text(size=20, colour = "black"))
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.5)) + xlim(0,20) +
labs(y = "Compositional similarity (LGM & Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
png(file = "si_fig_sed_rate.png", width = 8, height = 5, units = "in", res = 300)
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.5)) + xlim(0,20) +
labs(y = "Compositional similarity (LGM & Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
dev.off()
png(file = "si_fig_sed_rate_all.png", width = 12, height = 5, units = "in", res = 300)
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.5)) +
labs(y = "Compositional similarity (LGM & Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
dev.off()
png(file = "si_fig_sed_rate.png", width = 12, height = 5, units = "in", res = 300)
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.5)) + xlim(0,20)
labs(y = "Compositional similarity (LGM vs. Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
dev.off()
png(file = "si_fig_sed_rate.png", width = 12, height = 5, units = "in", res = 300)
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.3)) + xlim(0,20)
labs(y = "Compositional similarity (LGM vs. Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
dev.off()
png(file = "si_fig_sed_rate.png", width = 12, height = 5, units = "in", res = 300)
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.3)) + xlim(0,20) +
labs(y = "Compositional similarity (LGM vs. Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
dev.off()
dim(sim_sed)
394-244
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.3)) +
labs(y = "Compositional similarity (LGM vs. Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.3)) + xlim(0,20) +
labs(y = "Compositional similarity (LGM vs. Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
sim_sed[which(!is.na(sim_sed$c22),]
png(file = "si_fig_sed_rate.png", width = 12, height = 5, units = "in", res = 300)
ggplot(sim_sed, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.3)) + xlim(0,20) +
labs(y = "Compositional similarity (LGM vs. Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
dev.off()
sim_sed[which(!is.na(sim_sed$c22)),]
sim_sed[which(!is.na(sim_sed$c22) & !is.na(sim_sed$sed_rate_cmky)),]
sed_data <- sim_sed[which(!is.na(sim_sed$c22) & !is.na(sim_sed$sed_rate_cmky)),]
png(file = "si_fig_sed_rate.png", width = 12, height = 5, units = "in", res = 300)
ggplot(sed_data, aes(x=sed_rate_cmky, y=c22)) +
geom_point(size=2, pch = 21, stroke = 1, fill = alpha("blue",0.3)) + xlim(0,20) +
labs(y = "Compositional similarity (LGM vs. Holocene)", x = "Sedimentation rate (cm/ky)") +
theme_bw() +
theme(axis.text=element_text(size=14, colour = "black"),
axis.title=element_text(size=16, colour = "black"))
dev.off()
dim(sed_data)
# Finding WOA temperature for neighbouring points, to see if there are large differences because of distance
if (!file.exists("SST_neighbours.csv")){
setwd("/Users/marinacostarillo/Google Drive/PhD/projects/competition-forams/data/ocean")
tmn <- read.csv("woa13_decav_t00mn01v2.csv", header = T,stringsAsFactors = FALSE)
tsd <- read.csv("woa13_decav_t00sd01v2.csv", header = T,stringsAsFactors = FALSE)
setwd("/Users/marinacostarillo/Google Drive/PhD/Projects/buckley-bias/short_paper")
neighb <- historical[,c("sample", "Museum_no", "Lat", "Long")]
neighb$distance <- 0
neighb$age <- c("Historical")
neighb_holocene <- holocene[,c("sample", "Sample_ID", "Latitude", "Longitude", "distance")]
neighb_holocene$age <- c("Holocene")
neighb_lgm <- lgm[,c("sample", "Core", "Lat", "Long", "distance")]
neighb_lgm$age <- c("LGM")
names(neighb) <- names(neighb_holocene) <- names(neighb_lgm) <- c("sample", "Sample_Core_no", "Latitude", "Longitude", "distance", "age")
neighb <- rbind(neighb, rbind(neighb_holocene,neighb_lgm))
neighb <- neighb[order(neighb[,c("sample")]),]
for(j in 1:nrow(neighb)){
print(neighb[j, "sample"])
point <- neighb[j,c("Longitude","Latitude")]
woa_mn <- find_neighbours(point, findin = tmn[,c("Long","Lat")], distance = 0)
woa_sd <- find_neighbours(point, findin = tsd[,c("Long","Lat")], distance = 0)
neighb[j,"woamn"] <- mean(tmn[woa_mn$row_findin,"X0"], na.rm = T)
neighb[j,"woasd"] <- mean(tsd[woa_sd$row_findin,"X0"], na.rm = T)
neighb[j,"woamn_dist_km"] <-mean( woa_mn$distance, na.rm = T)
neighb[j,"woasd_dist_km"] <- mean(woa_sd$distance, na.rm = T)
}
write.csv(neighb, "SST_neighbours.csv", row.names = F)
}else{
neighb <- read.csv("SST_neighbours.csv", header = TRUE)
}
# neighb
# Large SST differences for sample M.8780
neighb[which(neighb$sample=="A10"),]
# Find other ForCenS neighbours, within 500 km radius
new_neighb <- find_neighbours(point = neighb[which(neighb$sample=="A10" & neighb$age=="Historical"),c("Longitude","Latitude")],
findin = holocene_full[,c("Longitude","Latitude")], distance = 500000)
# new neighbour of M.8780: the one with least SST difference
new_neighb <- new_neighb[which.min(abs(neighb[which(neighb$sample=="A10" & neighb$age=="Historical"),"woamn"] -
holocene_full[new_neighb$row_findin,"woa_tmn"])),]
new_holocene_neighb <- cbind(sample = "A10", new_neighb, holocene_full[new_neighb$row_findin,])
neighb
new_holocene_neighb
neighb
440-374
# Sedimentation rate
sim_sed <- merge(lgm_forcens_sim_mean,
lgm_full[,c("Lat", "Long","Core","Water.depth..m.", "Ocean", "sed_rate_cmky")],
all.y=F)
sim_sed <- unique(sim_sed[,c("c22","Lat", "Long","Core","Water.depth..m.", "Ocean", "sed_rate_cmky")])
sed_data <- sim_sed[which(!is.na(sim_sed$c22) & !is.na(sim_sed$sed_rate_cmky)),]
dim(sed_data)
